/**
 * Created by liuchengyun on 2017/5/24.
 */
//特巡报告控制器
app.controller('patrolReportController',function ($scope,$cookieStore,$http,$resource,$route,$routeParams,$location,CONSTANT,dataService) {
    //********************************作用域存储变量**********开始********************************
    $scope.queryId = $routeParams.id;
    $scope.issuccess = false;
    //********************************作用域存储变量**********结束********************************
    // -------------------------------------------------------------------------------------------
    // -----------------------------------分割线--------------------------------------------------
    // -------------------------------------------------------------------------------------------
    // ******************************.辅助功能性方法区域******开始********************************

    // *******************************辅助功能性方法区域******结束********************************
    // ------------------------------------------------------------------------------------------
    // -----------------------------------分割线-------------------------------------------------
    // ------------------------------------------------------------------------------------------
    // ******************************.视图业务控制接口区域******开始******************************

    //查看生成的报表页面
    $scope.showReport = function () {
        //每次查询前判断验证用户是否过期
        $http({
            method:'post',
            url: CONSTANT.URL_LIST.WCF + 'patrol/show/' + $scope.queryId,
        }).then(function (res) {
            if(res.data.return_flag==0){
                // 更新成功
                $scope.headerInfo = res.data.patrol_header;
                $scope.detailList = res.data.patrol_detail_list;
                $scope.issuccess = true;
                //$location.path('/patrol').replace();
            }else{
                //关闭详情窗口 回到列表页面获,取数据失败
                $scope.issuccess = false;
                //$location.path('/patrol').replace();
            }
        });
    }
    // *******************************视图业务控制接口区域******结束*****************************
    // ------------------------------------------------------------------------------------------
    // -----------------------------------分割线-------------------------------------------------
    // ------------------------------------------------------------------------------------------
    // ******************************.控制器初始化区域******开始**********************************
    $scope.Init = function () {
        //获取列表信息
        $scope.showReport();
    }
    // *******************************控制器初始化区域******结束**********************************

    //启动函数
    $scope.Init();
});